<!DOCTYPE html>
<html>
  <head>
  <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="./js/lib/react.js"></script>
    <script src="./js/lib/react-dom.js"></script>
    <script src="./js/lib/jquery.min.js"></script>  
    <script src="./js/lib/browser.min.js"></script>

  </head>
  <body>
    <div id="wrap"></div>
    <script type="text/babel">
      var MyTopNav = React.createClass({
        render: function(){
          return (
            <nav className="navbar navbar-default">
              <div className="container-fluid">
                <div className="navbar-header">
                  <a className="navbar-brand">商品</a>
                </div>
              </div>
            </nav>
          )
        }
      });

      var MyNavBar = React.createClass({
          //左侧树形菜单组件
          getInitialState: function() {
            return {
              listData : [],
            };
          },
          componentDidMount: function() {
            //在组件完成挂载的时候 发送ajax请求，获取所有类别资源
            $.ajax({
              type: "get",
              url : this.props.source,
              dataType: "json",
              success: function(data){
                  if(data.status == 200){
                    //数据请求成功
                    this.setState({
                      //更改status状态 重新render组件
                      listData: data.result
                    })
                  }                
              }.bind(this)
            })
          },

          render: function () {
              return (
                  <div className="col-xs-2 sidebar">
                    <ul className="nav nav-sidebar nav-pills nav-stacked">{                   
                       this.state.listData.map(function(item,index){
                          return (
                          <li key={index} role="presentation" >
                            <a key={item.categoryId} id={item.categoryId} href={`#${item.categoryName}`} aria-controls={item.categoryName} role="tab" data-toggle="tab">{item.categoryName}</a>
                          </li>
                          )
                       })                     
                    }</ul>
                  </div>
              );
          }
      });

      var MyItems = React.createClass({

        render: function(){
          return (
            <div className="col-xs-3">
              <div className="thumbnail ">
                <a href={this.props.goto} target="_blank" className="thumbnails">
                  <img src={this.props.product_imgurl} />
                </a>
                <div className="caption">
                  <p className="text-center">{this.props.product_name}</p>
                </div>
            </div>
          </div>
          );
        }
      });


      //从服务器获取所有商品列表之后，这个就可以删掉了
      var productList = [
        {
          name: "商品1",
          url: "/images/da.jpg"
        },
        {
          name: "商品1",
          url: "/images/da.jpg"
        },
      ]

      var MyContent = React.createClass({
        //商品列表组件
        getInitialState: function() {
            return {
              productList : [],
            };
        },  

        componentDidMount: function() {
          //在组件完成挂载的时候 发送ajax请求，获取所有商品资源
          $.ajax({
            type: "get",
            url : this.props.source,
            dataType: "json",
            success: function(data){
                if(data.status == 200){
                  //数据请求成功
                  this.setState({
                    //更改status状态 重新render组件
                    productList: data.result
                  })
                }                
            }.bind(this)
          })
        },

        render: function(){
          return ( 
            <div className="col-xs-10 main">
                <div className="row">{

                  //this.state.productList.map(function(){});   预留给你实现一下获取所有商品的


                  productList.map(function(item,index){
                    return (
                      <MyItems goto={item.url} product_name={item.name} product_imgurl={item.url} key={index} />
                    )

                  })

                }</div>
            </div>
          )
        }

      });

      var MyWrap = React.createClass({
        //整个网页包裹组件
        render: function(){
          return (
            <div>{
            React.Children.map(this.props.children, function (child) {
              return <div>{child}</div>
            })
            }</div>
          );
        }
      });
    
      ReactDOM.render(
        <MyWrap>
          <MyTopNav />
          <div className="container-fluid">
            <div className="row">
              <MyNavBar source="http://localhost:8089/api/categories" />
              <MyContent />
            </div>
          </div>
        </MyWrap>,
        document.getElementById('wrap')
      );
    </script>
  </body>
</html>
